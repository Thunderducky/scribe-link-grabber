<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Links Page</title>
  <script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous">
  </script>
  <script type="text/javascript" src="markdown.js"></script>
</head>
<body>
  <a href="/">Home</a>
  <div style="display:flex">
    <div>
      <button id="reload">Reload</button><br>
      <textarea id="markdown" value="test" style="width:418px; height:715px"></textarea><br/>
      <button id="export">Export</button>
    </div>
    <div id="parsed">
      Parsed goes here
    </div>
  </div>
  <script type="text/javascript">
    function download(data, filename, type) {
        var file = new Blob([data], {type: type});
        if (window.navigator.msSaveOrOpenBlob) // IE10+
            window.navigator.msSaveOrOpenBlob(file, filename);
        else { // Others
            var a = document.createElement("a"),
                    url = URL.createObjectURL(file);
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            setTimeout(function() {
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            }, 0);
        }
    }

    const render = () => {
      $("#parsed").html( markdown.toHTML($("#markdown").val()) );
    };

    const load = () => {
      $.get('/api/readme', function(res){
        console.log(res);
        $("#markdown").val(res);
        render();
      });
    }

    $("#reload").click(function(){
      load();
    });
    $("#preview").click(function(){
      render();
    })

    $('#markdown').bind('input propertychange', function() {
      render();
    });

    $("#export").click(function(){
      download($('#markdown').val(), "markdown.md", "text/markdown")
    });
    load();
  </script>
</body>
</html>
